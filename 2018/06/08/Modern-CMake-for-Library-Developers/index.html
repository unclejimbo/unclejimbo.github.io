<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"unclejimbo.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="CMake has followed the C++ standard on the road to modernization, which leads to simpler package and dependency management. As opposed to the old ways of doing CMake like setting CMAKE_CXX_FLAGS direc">
<meta property="og:type" content="article">
<meta property="og:title" content="Modern CMake for Library Developers">
<meta property="og:url" content="https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/index.html">
<meta property="og:site_name" content="unclejimbo&#39;s site">
<meta property="og:description" content="CMake has followed the C++ standard on the road to modernization, which leads to simpler package and dependency management. As opposed to the old ways of doing CMake like setting CMAKE_CXX_FLAGS direc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2018-06-07T16:00:00.000Z">
<meta property="article:modified_time" content="2022-04-21T06:25:08.022Z">
<meta property="article:author" content="unclejimbo">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="CMake">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Modern CMake for Library Developers | unclejimbo's site</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-97325233-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-97325233-1');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d49dcec5473b8cd98f08b6169b720538";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">unclejimbo's site</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-posts">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Posts</a>

  </li>
        <li class="menu-item menu-item-publications">

    <a href="/publications" rel="section"><i class="fa fa-book fa-fw"></i>Publications</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/me.png">
      <meta itemprop="name" content="unclejimbo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="unclejimbo's site">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Modern CMake for Library Developers
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-08 00:00:00" itemprop="dateCreated datePublished" datetime="2018-06-08T00:00:00+08:00">2018-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-04-21 14:25:08" itemprop="dateModified" datetime="2022-04-21T14:25:08+08:00">2022-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          
            <span id="/2018/06/08/Modern-CMake-for-Library-Developers/" class="post-meta-item leancloud_visitors" data-flag-title="Modern CMake for Library Developers" title="Views">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2018/06/08/Modern-CMake-for-Library-Developers/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/08/Modern-CMake-for-Library-Developers/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>CMake has followed the C++ standard on the road to modernization, which leads to simpler package and dependency management. As opposed to the old ways of doing CMake like setting <code>CMAKE_CXX_FLAGS</code> directly, modern cmake introduces lots of facilities to handle dependencies more cleanly. But also like C++, CMake is a huge monster now which is very hard to tame. Although there are a few talks and tutorials about modern CMake on the Internet, I still find them hard to follow for the first time.</p>
<p>Here I’ll present a detailed explaination on how to use modern CMake, especially for library developers who want to package their libraries for downstream developers to use easily with CMake. Basic knowledge of CMake is preferred, as I’ll not cover too much on some basic commands.</p>
<span id="more"></span>

<h1 id="Project-Structure"><a href="#Project-Structure" class="headerlink" title="Project Structure"></a>Project Structure</h1><blockquote>
<p>The example code in this blog post is an simplified version of my project <a target="_blank" rel="noopener" href="https://github.com/unclejimbo/yet-another-ray-tracer">yart</a>, stripping off the real files and 3rd-party dependencies. If you’d like to see a working example, you could try the code itself, there are only two external dependencies you need to install for it to work.</p>
</blockquote>
<p>Now suppose we are building a library <code>yart</code>, and the project is structured like bellow,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- yart</span><br><span class="line">    - cmake</span><br><span class="line">        - yart-config.cmake.in  // talk this later</span><br><span class="line">    - example</span><br><span class="line">        - main.cpp              // an example program using yart</span><br><span class="line">        - CMakeLists.txt</span><br><span class="line">    - include</span><br><span class="line">        - yart</span><br><span class="line">            - yart.h            // the main api header</span><br><span class="line">    - src</span><br><span class="line">        - yart.cpp              // the implementation file</span><br><span class="line">        - util.h                // some internal utilities not intended for yart users</span><br><span class="line">        - CMakeLists.txt</span><br><span class="line">    - CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p>Let’s start with the parent level <code>CMakeLists.txt</code>. Nothing interesting here, I’d like to use C++17 so CMake 3.10 is required. The <code>project</code> command will create a <code>YART</code> project as well as versioning variables including <code>YART_VERSION</code>, <code>YART_VERSION_MAJOR</code>, <code>YART_VERSION_MINOR</code> and <code>YART_VERSION_PATCH</code>.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(YART</span><br><span class="line">    LANGUAGES CXX</span><br><span class="line">    VERSION <span class="number">0.1</span>.<span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(examples)</span><br></pre></td></tr></table></figure>

<h1 id="A-Song-of-Targets-and-Properties"><a href="#A-Song-of-Targets-and-Properties" class="headerlink" title="A Song of Targets and Properties"></a>A Song of Targets and Properties</h1><p>Targets are the main objects CMake manipulate for building a project. Your library is a target, your executable is a target, and you’ll also meet some other types of targets when setting up the build system.</p>
<p>And each target has a set of properties attached to them, in an OO sense that they even have access control. You’ll soon notice that many commands in CMake has a signature similar to <code>command(your-target [PUBLIC|INTERFACE|PRIVATE] properties)</code>. An <code>INTERFACE</code> property means that a user will need to respect this property when depending on this target, while a <code>PRIVATE</code> property means that this property is only used internally. And <code>PUBLIC</code> means both.</p>
<h2 id="Create-a-Target"><a href="#Create-a-Target" class="headerlink" title="Create a Target"></a>Create a Target</h2><p>Without further ado, let’s set up our library first in <code>src/CMakeLists.txt</code>.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(yart</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/yart.cpp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>You might have seen or have used <code>file(GLOB ...)</code> before, please be advised that you should explicitly list the source files like the example above for the build system to automatically reconfigure CMake when you add a new source file.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(yart::yart ALIAS yart)</span><br></pre></td></tr></table></figure>

<p>This line enables you to use <code>yart::yart</code> in the <code>example</code> target, will see late</p>
<h2 id="Configure-the-Target"><a href="#Configure-the-Target" class="headerlink" title="Configure the Target"></a>Configure the Target</h2><p>We would like the users to choose whether to build a shared library or a static one,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span>(BUILD_SHARED_LIBS <span class="string">&quot;Build shared library&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">include</span>(GenerateExportHeader)</span><br><span class="line">generate_export_header(yart</span><br><span class="line">    EXPORT_MACRO_NAME YART_API</span><br><span class="line">    EXPORT_FILE_NAME <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/<span class="keyword">include</span>/yart/core/common.h</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>There’re a lot of interesting thing going on here. In the first command, <code>BUILD_SHARED_LIBS</code> is read by CMake to switch between static and shared library, and a user could alter this option in cache.</p>
<p>Well, the <code>generate_export_header</code> command creates a header file which helps switch between building shared and static libraries. And here is the generated <code>common.h</code> file with msvc, and you should use these macros to export your library symbols like <code>void YART_API my_api_fcn();</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> YART_API_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> YART_API_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> YART_STATIC_DEFINE</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> YART_API</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> YART_NO_EXPORT</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">ifndef</span> YART_API</span></span><br><span class="line"><span class="meta">#    <span class="keyword">ifdef</span> yart_EXPORTS</span></span><br><span class="line">        <span class="comment">/* We are building this library */</span></span><br><span class="line"><span class="meta">#      <span class="keyword">define</span> YART_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#    <span class="keyword">else</span></span></span><br><span class="line">        <span class="comment">/* We are using this library */</span></span><br><span class="line"><span class="meta">#      <span class="keyword">define</span> YART_API __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#    <span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#  <span class="keyword">ifndef</span> YART_NO_EXPORT</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> YART_NO_EXPORT</span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> YART_DEPRECATED</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> YART_DEPRECATED __declspec(deprecated)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> YART_DEPRECATED_EXPORT</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> YART_DEPRECATED_EXPORT YART_API YART_DEPRECATED</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> YART_DEPRECATED_NO_EXPORT</span></span><br><span class="line"><span class="meta">#  <span class="keyword">define</span> YART_DEPRECATED_NO_EXPORT YART_NO_EXPORT YART_DEPRECATED</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0 <span class="comment">/* DEFINE_NO_DEPRECATED */</span></span></span><br><span class="line"><span class="meta">#  <span class="keyword">ifndef</span> YART_NO_DEPRECATED</span></span><br><span class="line"><span class="meta">#    <span class="keyword">define</span> YART_NO_DEPRECATED</span></span><br><span class="line"><span class="meta">#  <span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* YART_API_H */</span></span></span><br></pre></td></tr></table></figure>

<p>The pattern <code>$&lt;:&gt;</code> you see earlier is <a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html">generator-expressions</a> which works just like <code>if</code> statement but could be compactly inserted into other cmake commands like this <code>target_compile_definitions</code> command. Notice the <code>PUBLIC</code> keyword here, it says that this definition is a public property of <code>yart</code>.</p>
<p>And now, we’d like to configure the compiler options,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_compile_features</span>(yart PUBLIC cxx_std_17)</span><br><span class="line"><span class="keyword">target_compile_options</span>(yart PRIVATE</span><br><span class="line">    $&lt;$&lt;<span class="keyword">OR</span>:$&lt;CXX_COMPILER_ID:Clang&gt;,$&lt;CXX_COMPILER_ID:GNU&gt;&gt;:</span><br><span class="line">        -pipe -march=native</span><br><span class="line">        $&lt;$&lt;CONFIG:Debug&gt;:-O0 -Wall -Wextra&gt;&gt;</span><br><span class="line">    $&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:</span><br><span class="line">        $&lt;$&lt;CONFIG:Debug&gt;:/Od /Wall /Zi&gt;&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>With <code>target_compile_features</code>, you could directly demand a language standard version like I did, or you could require specific c++ features like <code>target_compile_feature(yart PUBLIC cxx_const_expr)</code>. The second command specify compile options depending on the compilers and build type, again with generator-expressions.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(yart</span><br><span class="line">    PUBLIC</span><br><span class="line">        $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">        $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">        $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;</span><br><span class="line">    PRIVATE</span><br><span class="line">        <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>The <code>target_include_directories</code> command set up the include directories of <code>yart</code>. Public api is located in <code>$&lt;CMAKE_SOURCE_DIR&gt;/include/</code>, as well as the generated <code>common.h</code> file, and the private header file is in the same directory as <code>$&lt;CMAKE_CURRENT_SOURCE_DIR&gt;</code>. Notice that <code>$&lt;INSTALL_INTERFACE:include&gt;</code> is needed for users to find <code>yart</code> headers after installing <code>yart</code> onto their system. The <code>include</code> directory is a relative path to <code>$&#123;CMAKE_INSTALL_PREFIX&#125;</code> which is often <code>/usr/local</code> on Linux and <code>C:\Program Files</code> on Windows.</p>
<p>And we would also like to organize the build tree a bit and configure where to output generated binaries,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(yart PROPERTIES</span><br><span class="line">    ARCHIVE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/lib</span><br><span class="line">    LIBRARY_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/lib</span><br><span class="line">    RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/bin</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>*.lib will go to <code>ARCHIVE_OUTPUT_DIRECTORY</code>, *.so will go to <code>LIBRARY_OUTPUT_DIRECTORY</code>, and *.dll will go to <code>RUNTIME_OUTPUT_DIRECTORY</code>.</p>
<h2 id="Handle-3rd-Party-Dependencies"><a href="#Handle-3rd-Party-Dependencies" class="headerlink" title="Handle 3rd Party Dependencies"></a>Handle 3rd Party Dependencies</h2><p>Suppose we have two 3rd-party dependencies,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(libmodern REQRUIED)</span><br><span class="line"><span class="keyword">find_package</span>(liblegacy <span class="number">3.0</span> REQUIRED)</span><br></pre></td></tr></table></figure>

<p>Since <code>libmodern</code> is written with modern CMake as well, we could simply do,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(yart PUBLIC libmodern::libmodern)</span><br></pre></td></tr></table></figure>

<p>And that’s it, modern CMake could handle target dependencies transitively, which means that you could forget about the messy variables and every property needed to use <code>libmodern</code> is handled correctly.</p>
<p>On the other hand, <code>liblegacy</code> is too old for this, so you have to switch to the old method,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(yart PUBLIC $&lt;BUILD_INTERFACE:<span class="variable">$&#123;LIBLEGACY_INCLUDE_DIRS&#125;</span>&gt;)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(yart PUBLIC <span class="variable">$&#123;LIBLEGACY_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>And be alert that the public include requirement is not handled transitively so that <code>yart</code> users won’t know anything about it, yet. We’ll fix that later on. Notice you could also write a <code>FindLibLegacy.cmake</code> file for it and handle all sorts of usage requirements there, and finally export only a <code>liblegacy::liblegacy</code> target. You can find a decent example <a target="_blank" rel="noopener" href="https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/">here</a>.</p>
<h2 id="Install-and-Export-the-Target"><a href="#Install-and-Export-the-Target" class="headerlink" title="Install and Export the Target"></a>Install and Export the Target</h2><p>Everything should be able to compile by now. But the library is not readily available for other developers to use right now, after they hit <code>make install</code> and write <code>find_package(yart)</code> in their <code>CMakeLists.txt</code>.</p>
<p>First, we need to ensure everything is installed to the correct places on system.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include(GNUInstallDirs)</span><br><span class="line"></span><br><span class="line">install(TARGETS yart</span><br><span class="line">    EXPORT yart-targets</span><br><span class="line">    ARCHIVE DESTINATION $&#123;CMAKE_INSTALL_LIBDIR&#125;</span><br><span class="line">    LIBRARY DESTINATION $&#123;CMAKE_INSTALL_LIBDIR&#125;</span><br><span class="line">    RUNTIME DESTINATION $&#123;CMAKE_INSTALL_BINDIR&#125;</span><br><span class="line">    INCLUDES DESTINATION $&#123;LIBLEGACY_INCLUDE_DIRS&#125;</span><br><span class="line">)</span><br><span class="line">install(DIRECTORY $&#123;CMAKE_SOURCE_DIR&#125;/include/yart</span><br><span class="line">    DESTINATION $&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>GUNInstallDirs</code> is a cross-platform solution to install directories. And we issue the <code>install</code> command to install our files. It has several signatures, in the above block are <code>install(TARGETS yart ...)</code>, which installs the compiled library, and <code>install(DIRECTORY ...)</code>, which installs the include directory to the right place. Note <code>EXPORT yart-targets</code> line also exports this target to be used later, and the <code>INCLUDE DESTINATION $&#123;LIBLEGACY_INCLUDE_DIRS&#125;</code> line injects the include dependencies into <code>yart-targets</code> so that our dependency problem mentioned above is solved here.</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> yart-targets</span><br><span class="line">    <span class="keyword">FILE</span> yart-targets.cmake</span><br><span class="line">    NAMESPACE yart::</span><br><span class="line">    DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/yart</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Talking about <code>EXPORT</code>, installing an <code>EXPORT</code> target will generate a <code>yart-targets.cmake</code> file which contains essential commands to build with <code>yart</code> correctly, like bellow,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create imported target yart::yart</span></span><br><span class="line"><span class="keyword">add_library</span>(yart::yart SHARED IMPORTED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_target_properties</span>(yart::yart PROPERTIES</span><br><span class="line">    ...</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>What’s more, the <code>find_package</code> command expects a <code>FindYART.cmake</code> file or a <code>yart-config.cmake</code> (<code>YARTConfig.cmake</code>) to find this library. The first method is an old way to hell so we definitely want the second one,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(CMakePackageConfigHelpers)</span><br><span class="line"></span><br><span class="line">configure_package_config_file(</span><br><span class="line">    <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake/yart-config.cmake.in</span><br><span class="line">    <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/cmake/yart-config.cmake</span><br><span class="line">    INSTALL_DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/yart</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">write_basic_package_version_file(</span><br><span class="line">    <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/cmake/yart-config-version.cmake</span><br><span class="line">    VERSION <span class="variable">$&#123;YART_VERSION&#125;</span></span><br><span class="line">    COMPATIBILITY AnyNewerVersion</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(</span><br><span class="line">    FILES</span><br><span class="line">        <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/cmake/yart-config.cmake</span><br><span class="line">        <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/cmake/yart-config-version.cmake</span><br><span class="line">    DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/yart</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>The <code>configure_package_config_file</code> command reads an scaffolding <code>yart-config.cmake.in</code> file and creates a <code>yart-config.cmake</code> file with the right paths. And let’s see what the .in file looks like,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@PACKAGE_INIT@</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(libmodern REQUIRED)</span><br><span class="line"><span class="keyword">find_package</span>(liblegacy <span class="number">3.0</span> REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">TARGET</span> yart::yart)</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_CURRENT_LIST_DIR&#125;</span>/yart-targets.cmake)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>Quite simple right? You need to call <code>@PACKAGE_INIT@</code> first, find dependencies and finally include the generated <code>yart-targets.cmake</code> file.</p>
<p>A version file is also preferred by users and could be created easily with <code>write_basic_package_version_file</code>. Notice that these files are generated in your build tree (<code>$&#123;CMAKE_BINARY_DIR&#125;</code>) and you need to install them into your system. The install directory is <code>$&#123;CMAKE_INSTALL_LIBDIR&#125;/cmake/yart</code> which is the default search directory of <code>find_package</code>.</p>
<p>One last step, remember that we also have another <code>example</code> alongside this library? We need to call the <code>export</code> command,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>(<span class="keyword">EXPORT</span> yart-targets</span><br><span class="line">    <span class="keyword">FILE</span> <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/cmake/yart-targets.cmake</span><br><span class="line">    NAMESPACE yart::</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>So that <code>example</code> could refer to <code>yart</code> without finding the package.</p>
<h1 id="Use-the-Target"><a href="#Use-the-Target" class="headerlink" title="Use the Target"></a>Use the Target</h1><p><code>example/CMakeLists.txt</code> couldn’t be more simple,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(yart-example</span><br><span class="line">    <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/main.cpp&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(yart-example PRIVATE</span><br><span class="line">    yart::yart</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>While using <code>yart</code> from an outside project requires one more magic touch,</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(yart)</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>That’s it folks. It’s still quite tricky to do everything right, but I’ve covered the most common use cases. If you still find it hard to wrap your head around it, just remember your library is a target and its build and usage requirements are properties set with <code>target_xxx</code> commands. Other exported targets and config files are auxillary infrastructures to help down stream developers to use your library easily.</p>
<p>For other bits and pieces, please refer to the document, which is not very intuitive unfortunately. You might also want to refer to</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bsXLMQ6WgIk">Effective CMake Talk</a></li>
<li><a target="_blank" rel="noopener" href="https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/">It’s time to Do CMake Right</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/PX4/eigen">Eigen</a>, which shows a good example on how to do CMake right</li>
<li><a target="_blank" rel="noopener" href="https://gitlab.kitware.com/cmake/community/wikis/home">The official wiki</a>, which contains some explanations not showing in the documentation</li>
</ul>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>unclejimbo
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/" title="Modern CMake for Library Developers">https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
              <a href="/tags/CMake/" rel="tag"># CMake</a>
          </div>

        


        
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Project-Structure"><span class="nav-number">1.</span> <span class="nav-text">Project Structure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#A-Song-of-Targets-and-Properties"><span class="nav-number">2.</span> <span class="nav-text">A Song of Targets and Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Create-a-Target"><span class="nav-number">2.1.</span> <span class="nav-text">Create a Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configure-the-Target"><span class="nav-number">2.2.</span> <span class="nav-text">Configure the Target</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Handle-3rd-Party-Dependencies"><span class="nav-number">2.3.</span> <span class="nav-text">Handle 3rd Party Dependencies</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Install-and-Export-the-Target"><span class="nav-number">2.4.</span> <span class="nav-text">Install and Export the Target</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-the-Target"><span class="nav-number">3.</span> <span class="nav-text">Use the Target</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-number">4.</span> <span class="nav-text">Conclusion</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="unclejimbo"
      src="/images/me.png">
  <p class="site-author-name" itemprop="name">unclejimbo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/unclejimbo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;unclejimbo" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangsd@ios.ac.cn" title="E-Mail → mailto:wangsd@ios.ac.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">unclejimbo</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"JVGcFwDqMgSaNGKdFXnKQLH5-gzGzoHsz","app_key":"Vc3vhEn4KvHJX7OTHMpugy14","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://unclejimbos.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://unclejimbo.github.io/2018/06/08/Modern-CMake-for-Library-Developers/";
    this.page.identifier = "2018/06/08/Modern-CMake-for-Library-Developers/";
    this.page.title = "Modern CMake for Library Developers";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://unclejimbos.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
